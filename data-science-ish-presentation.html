<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Data Science-Ish: The Use of Mixed Effects (or Multi-Level) Models for Analyzing Complex Data Sources</title>
    <meta charset="utf-8" />
    <meta name="author" content="Joshua Rosenberg" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis.css" rel="stylesheet" />
    <link href="libs/remark-css/metropolis-fonts.css" rel="stylesheet" />
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Data Science-Ish: The Use of Mixed Effects (or Multi-Level) Models for Analyzing Complex Data Sources
### Joshua Rosenberg
### 2019-06-20 (updated: 2019-06-20)

---




# #whoami

.pull-left[
* Joshua Rosenberg, Ph.D.
* Assistant Professor, STEM Education, University of Tennessee, Knoxville
* Dad (16 month toddler!)
* Primary areas of interest
  * Data science in education
  * Data science education
]

&lt;img src="img/kr-joro.jpg" width="350px" style="display: block; margin: auto;" /&gt;

---
class: inverse, center, middle
# Background/Motivation

---

# Rationale and Aim

- Mixed effects (or multilevel) models are extensions of linear models (regressions)
- Commonly used in experimental and observational research and policy and evaluation contexts
- Are less widely-used by data scientists
  - One piece of evidence: Cross Validated has 1,392 questions tagged #mixed-model that are unanswere (of 3,337 total questions)
- I am trying to introduce mixed effects model as a data science(-*ish*) statistical method that can be useful and is easy to estimate and interpret.

---

# Example: Rail-trails!

## Springfield Greenway

![](img/springfield-greenway.jpg)

*Image from kz440gal on TraiLink.com*

---

# The Rails-to-Trails Conservancy

- Rail trails are railroad tracks that have been converted into pathways/greenways
- The [Rails-to-Trails Conservancy](https://www.railstotrails.org/) is an organization "dedicated to creating a nationwide network of trails from former rail lines and connecting corridors to build healthier places for healthier people"
- [TrailLink](https://www.traillink.com/) is their website that lists most of the rail-trails in the United States (~4,000 total)
- Let's take a look at their website

---

# TrailLink.com

- What rail-trail is best?
  - In one state
  - Across the nation
- This can be a (surprisingly) difficult question to answer
- View trails in TN here: https://www.traillink.com/trailsearch/?mmloc=tn

**&lt;center&gt;What do you think? Which is (or, which are) the best?&lt;/center&gt;**

&lt;center&gt;Discuss your answer with an elbow partner!&lt;/center&gt;

---
class: inverse, center, middle
# Building up to Mixed Effects Models
---

# One data-based solution: Use a regression model!



$$
\text{y^} = \alpha + \beta_{1}(\text{var1}) + \beta_{2}(\text{var2}) + \epsilon
$$
---

# Accessing rail-trails data

- Use the `railtrails` R package
  - Install via `install.packages('railtrails')`)
  

```r
library(railtrails)
```


```r
railtrails
```

```
## # A tibble: 3,846 x 11
##    state name  distance surface category mean_review description n_reviews
##    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
##  1 AK    Chas…     14   Dirt, … Rail-Tr…           4 "Though cl…         1
##  2 AK    Tony…     11   Asphalt Rail-Tr…           5 "The Tony …         5
##  3 AK    Bird…     13   Asphalt Rail-Tr…           5 "The Bird …         3
##  4 AK    Camp…      7.5 Asphal… Greenwa…           5 "The Campb…         3
##  5 AK    Goos…      1.5 Asphal… Greenwa…           0 "The sceni…         0
##  6 AK    Home…      4   Asphalt Greenwa…           5 "On the so…         1
##  7 AK    Lani…      3.9 Asphal… Greenwa…           3 "The Lanie…         1
##  8 AK    Palm…      6.1 Gravel  Rail-Tr…           0 "As its na…         0
##  9 AK    Ship…      2.6 Asphalt Rail-Tr…           4 "Ship Cree…         1
## 10 AL    Chie…     33   Asphalt Rail-Tr…           5 "In northe…        77
## # … with 3,836 more rows, and 3 more variables: raw_reviews &lt;list&gt;,
## #   lat &lt;dbl&gt;, lng &lt;dbl&gt;
```

---

# Let's focus in on Tennessee


```r
library(dplyr)

d &lt;- railtrails %&gt;% 
  filter(state == "TN")

d
```

```
## # A tibble: 55 x 11
##    state name  distance surface category mean_review description n_reviews
##    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
##  1 TN    Tenn…     4.73 Asphal… Rail-Tr…           5 "The Tenne…         9
##  2 TN    Bets…     2    Asphalt Rail-Tr…           0 "The Betsy…         0
##  3 TN    Alta…     0.7  Asphal… Greenwa…           0 "Alta Lake…         0
##  4 TN    Bear…     2.7  Asphalt Greenwa…           0 "From Thir…         0
##  5 TN    Big …     1    Concre… Rail-Tr…           5 "Big River…         2
##  6 TN    Bria…     1.1  Asphalt Rail-Tr…           0 "The Brian…         0
##  7 TN    Broo…     0.4  Asphalt Greenwa…           3 "Brookmead…         5
##  8 TN    Cave…     0.95 Asphalt Greenwa…           0 "Cavet Sta…         0
##  9 TN    Chat…    13.1  Concre… Greenwa…           5 "The Chatt…        17
## 10 TN    Clar…     4.6  Asphalt Rail-Tr…           5 "The 4.6-m…        21
## # … with 45 more rows, and 3 more variables: raw_reviews &lt;list&gt;,
## #   lat &lt;dbl&gt;, lng &lt;dbl&gt;
```

---

# Let's 'unnest' the reviews


```r
d &lt;- d %&gt;% 
  unnest(raw_reviews) %&gt;% 
  rename(raw_review = raw_reviews)

d
```

```
## # A tibble: 281 x 11
##    state name  distance surface category mean_review description n_reviews
##    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;int&gt; &lt;chr&gt;           &lt;int&gt;
##  1 TN    Tenn…     4.73 Asphal… Rail-Tr…           5 "The Tenne…         9
##  2 TN    Tenn…     4.73 Asphal… Rail-Tr…           5 "The Tenne…         9
##  3 TN    Tenn…     4.73 Asphal… Rail-Tr…           5 "The Tenne…         9
##  4 TN    Tenn…     4.73 Asphal… Rail-Tr…           5 "The Tenne…         9
##  5 TN    Tenn…     4.73 Asphal… Rail-Tr…           5 "The Tenne…         9
##  6 TN    Tenn…     4.73 Asphal… Rail-Tr…           5 "The Tenne…         9
##  7 TN    Tenn…     4.73 Asphal… Rail-Tr…           5 "The Tenne…         9
##  8 TN    Tenn…     4.73 Asphal… Rail-Tr…           5 "The Tenne…         9
##  9 TN    Tenn…     4.73 Asphal… Rail-Tr…           5 "The Tenne…         9
## 10 TN    Bets…     2    Asphalt Rail-Tr…           0 "The Betsy…         0
## # … with 271 more rows, and 3 more variables: lat &lt;dbl&gt;, lng &lt;dbl&gt;,
## #   raw_review &lt;int&gt;
```

---


```r
m1 &lt;- lm(raw_review ~ -1 + name, data = d)
```

---
# Finding the means of the reviews


```r
mean_reviews &lt;- d %&gt;% 
  group_by(name) %&gt;% 
  summarize(mean_review = mean(raw_review, na.rm = TRUE),
            sd_review = sd(raw_review, na.rm = TRUE),
            n_reviews = n()) %&gt;% 
  arrange(desc(mean_review))

mean_reviews
```

```
## # A tibble: 55 x 4
##    name                                     mean_review sd_review n_reviews
##    &lt;chr&gt;                                          &lt;dbl&gt;     &lt;dbl&gt;     &lt;int&gt;
##  1 Big River Crossing                              5        0             2
##  2 North Chicamauga Creek Greenway                 5       NA             1
##  3 Springfield Greenway                            5        0             8
##  4 White House Greenway                            5        0             3
##  5 Murfreesboro's Stones River Greenway Sy…        4.88     0.354        14
##  6 Wolf River Greenway                             4.86     0.378        10
##  7 Clarksville Greenway                            4.79     0.535        21
##  8 Shelby Farms Greenline                          4.75     0.452        16
##  9 Kingsport Greenbelt                             4.67     0.707        11
## 10 "Cumberland River Bicentennial Trail "          4.62     0.5          27
## # … with 45 more rows
```
---

# Plotting the results


```r
library(ggplot2)
mean_reviews %&gt;% 
  filter(!is.na(mean_review)) %&gt;% 
  ggplot(aes(x = reorder(name, mean_review), y = mean_review)) +
  geom_point(color = "red") +
  geom_errorbar(aes(ymin = mean_review - sd_review * 1.96 / sqrt(n_reviews - 1),
                ymax = mean_review + sd_review * 1.96 / sqrt(n_reviews - 1))) +
  coord_flip()
```

&lt;img src="data-science-ish-presentation_files/figure-html/unnamed-chunk-10-1.png" style="display: block; margin: auto;" /&gt;

---

# What does the model look like?



---
class: inverse, center, middle
# Examples
---
I focus on two examples using the lme4 package in R: one each that is focused on:
traditional research (modeling hierarchically nested data
student engagement in science
commercial (estimating the best product when products have different numbers of reviews) uses
What is the best pair of boots? R.E.I.

---
class: inverse, center, middle
# Connection to Bayesian Methods
---

Finally, I discuss the close connection between mixed effects models and Bayesian methods.
brms

---
class: inverse, center, middle
# Conclusion
---
sd

---

class: inverse, center, middle
# Wrapping up
---

# Contact
- [Joshua Rosenberg](mailto:jmrosenberg@utk.edu)
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
